<div class="row g-3">
    <!-- Header -->
    <div class="col-12">
        <h4 class="fw-bold text-primary mb-3">
            <i class="bi bi-crosshair me-2"></i>Contextual Performance Dashboard
        </h4>
        <div class="alert alert-soft-primary small p-2">
            This dashboard isolates your performance across specific market conditions (Events, News, Trends, Volume).
        </div>
    </div>

    <!-- 1. Event Trading -->
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm metric-card">
            <div class="card-body text-center">
                <div class="metric-icon bg-warning-subtle text-warning mb-2">‚ö°</div>
                <h6 class="text-uppercase text-muted small fw-bold">Event Trading</h6>
                <div class="d-flex justify-content-between px-3 mt-3">
                    <div class="text-start">
                        <small class="d-block text-muted">Count</small>
                        <span class="h5 mb-0">{{ report.web_data.kpis.event_trading_count|default(0) }}</span>
                    </div>
                    <div class="text-end">
                        <small class="d-block text-muted">Win Rate</small>
                        <span
                            class="badge {{ 'bg-success' if report.web_data.kpis.event_trading_win_rate|default(0)|float > 50 else 'bg-danger' }}">
                            {{ report.web_data.kpis.event_trading_win_rate|default(0)|float|round(1) }}%
                        </span>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-top">
                    <small class="text-muted">Net P&L</small>
                    <div
                        class="fw-bold {{ 'text-success' if report.web_data.kpis.event_trading_pnl|default(0)|float > 0 else 'text-danger' }}">
                        ‚Çπ{{ report.web_data.kpis.event_trading_pnl|default(0)|float|round(0) }}
                    </div>
                </div>

                <!-- AI INSIGHT -->
                <div class="mt-3 p-2 bg-light rounded text-start border-start border-4 border-warning">
                    <div class="d-flex align-items-center mb-1">
                        <i class="bi bi-robot text-warning me-2"></i>
                        <span class="fw-bold small text-dark">{{ report.analysis_text.context_performance.event.verdict
                            | default("") }}</span>
                    </div>
                    <p class="small text-muted mb-0 lh-sm">{{ report.analysis_text.context_performance.event.reasoning |
                        default("") }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. News Trading -->
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm metric-card">
            <div class="card-body text-center">
                <div class="metric-icon bg-info-subtle text-info mb-2">üì∞</div>
                <h6 class="text-uppercase text-muted small fw-bold">News Trading</h6>
                <div class="d-flex justify-content-between px-3 mt-3">
                    <div class="text-start">
                        <small class="d-block text-muted">Count</small>
                        <span class="h5 mb-0">{{ report.web_data.kpis.news_trading_count|default(0) }}</span>
                    </div>
                    <div class="text-end">
                        <small class="d-block text-muted">Win Rate</small>
                        <span
                            class="badge {{ 'bg-success' if report.web_data.kpis.news_trading_win_rate|default(0)|float > 50 else 'bg-danger' }}">
                            {{ report.web_data.kpis.news_trading_win_rate|default(0)|float|round(1) }}%
                        </span>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-top">
                    <small class="text-muted">Net P&L</small>
                    <div
                        class="fw-bold {{ 'text-success' if report.web_data.kpis.news_trading_pnl|default(0)|float > 0 else 'text-danger' }}">
                        ‚Çπ{{ report.web_data.kpis.news_trading_pnl|default(0)|float|round(0) }}
                    </div>
                </div>

                <!-- AI INSIGHT -->
                <div class="mt-3 p-2 bg-light rounded text-start border-start border-4 border-info">
                    <div class="d-flex align-items-center mb-1">
                        <i class="bi bi-robot text-info me-2"></i>
                        <span class="fw-bold small text-dark">{{ report.analysis_text.context_performance.news.verdict |
                            default("") }}</span>
                    </div>
                    <p class="small text-muted mb-0 lh-sm">{{ report.analysis_text.context_performance.news.reasoning |
                        default("") }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. High Volume Trading -->
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm metric-card">
            <div class="card-body text-center">
                <div class="metric-icon bg-purple-subtle text-purple mb-2">üìä</div>
                <h6 class="text-uppercase text-muted small fw-bold">High Volume Trading</h6>
                <div class="d-flex justify-content-between px-3 mt-3">
                    <div class="text-start">
                        <small class="d-block text-muted">Count</small>
                        <span class="h5 mb-0">{{ report.web_data.kpis.high_volume_trading_count|default(0) }}</span>
                    </div>
                    <div class="text-end">
                        <small class="d-block text-muted">Win Rate</small>
                        <span
                            class="badge {{ 'bg-success' if report.web_data.kpis.high_volume_trading_win_rate|default(0)|float > 50 else 'bg-danger' }}">
                            {{ report.web_data.kpis.high_volume_trading_win_rate|default(0)|float|round(1) }}%
                        </span>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-top">
                    <small class="text-muted">Net P&L</small>
                    <div
                        class="fw-bold {{ 'text-success' if report.web_data.kpis.high_volume_trading_pnl|default(0)|float > 0 else 'text-danger' }}">
                        ‚Çπ{{ report.web_data.kpis.high_volume_trading_pnl|default(0)|float|round(0) }}
                    </div>
                </div>

                <!-- AI INSIGHT -->
                <div class="mt-3 p-2 bg-light rounded text-start border-start border-4 border-purple"
                    style="border-color: #6f42c1 !important;">
                    <div class="d-flex align-items-center mb-1">
                        <i class="bi bi-robot text-purple me-2" style="color: #6f42c1;"></i>
                        <span class="fw-bold small text-dark">{{ report.analysis_text.context_performance.volume.verdict
                            | default("") }}</span>
                    </div>
                    <p class="small text-muted mb-0 lh-sm">{{ report.analysis_text.context_performance.volume.reasoning
                        | default("") }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. Trend Alignment (NIFTY) -->
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm metric-card">
            <div class="card-body text-center">
                <div class="metric-icon bg-success-subtle text-success mb-2">üåä</div>
                <h6 class="text-uppercase text-muted small fw-bold">Trend Alignment (Nifty)</h6>
                <div class="chart-container" style="height: 100px; position: relative;">
                    <!-- Mini Donut for Trend Score -->
                    <canvas id="trendAlignmentChart"></canvas>
                    <div class="donut-inner">
                        <h5 class="mb-0 fw-bold">{{ report.web_data.kpis.trend_alignment_score|default(0)|float|round(0)
                            }}%</h5>
                    </div>
                </div>
                <div class="mt-1">
                    <small class="text-muted">Trades Aligned with Market Direction</small>
                    <br>
                    <span class="badge bg-light text-dark border">
                        Aligned Win Rate: {{ report.web_data.kpis.trend_aligned_win_rate|default(0)|float|round(1) }}%
                    </span>
                </div>

                <!-- AI INSIGHT -->
                <div class="mt-3 p-2 bg-light rounded text-start border-start border-4 border-success">
                    <div class="d-flex align-items-center mb-1">
                        <i class="bi bi-robot text-success me-2"></i>
                        <span class="fw-bold small text-dark">{{ report.analysis_text.context_performance.trend.verdict
                            | default("") }}</span>
                    </div>
                    <p class="small text-muted mb-0 lh-sm">{{ report.analysis_text.context_performance.trend.reasoning |
                        default("") }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. Good Chart Trading -->
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm metric-card">
            <div class="card-body text-center">
                <div class="metric-icon bg-success-subtle text-success mb-2">üéØ</div>
                <h6 class="text-uppercase text-muted small fw-bold">Good Charts</h6>
                <div class="d-flex justify-content-between px-3 mt-3">
                    <div class="text-start">
                        <small class="d-block text-muted">Count</small>
                        <span class="h5 mb-0">{{ report.web_data.kpis.good_chart_trading_count|default(0) }}</span>
                    </div>
                    <div class="text-end">
                        <small class="d-block text-muted">Win Rate</small>
                        <span
                            class="badge {{ 'bg-success' if report.web_data.kpis.good_chart_trading_win_rate|default(0)|float > 50 else 'bg-danger' }}">
                            {{ report.web_data.kpis.good_chart_trading_win_rate|default(0)|float|round(1) }}%
                        </span>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-top">
                    <small class="text-muted">Net P&L</small>
                    <div
                        class="fw-bold {{ 'text-success' if report.web_data.kpis.good_chart_trading_pnl|default(0)|float > 0 else 'text-danger' }}">
                        ‚Çπ{{ report.web_data.kpis.good_chart_trading_pnl|default(0)|float|round(0) }}
                    </div>
                </div>

                <!-- AI INSIGHT -->
                <div class="mt-3 p-2 bg-light rounded text-start border-start border-4 border-success">
                    <div class="d-flex align-items-center mb-1">
                        <i class="bi bi-robot text-success me-2"></i>
                        <span class="fw-bold small text-dark">{{
                            report.analysis_text.context_performance.chart_quality.verdict | default("") }}</span>
                    </div>
                    <p class="small text-muted mb-0 lh-sm">{{
                        report.analysis_text.context_performance.chart_quality.reasoning | default("") }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 6. Bad Chart Trading -->
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm metric-card">
            <div class="card-body text-center">
                <div class="metric-icon bg-danger-subtle text-danger mb-2">‚ö†Ô∏è</div>
                <h6 class="text-uppercase text-muted small fw-bold">Bad Charts</h6>
                <div class="d-flex justify-content-between px-3 mt-3">
                    <div class="text-start">
                        <small class="d-block text-muted">Count</small>
                        <span class="h5 mb-0">{{ report.web_data.kpis.bad_chart_trading_count|default(0) }}</span>
                    </div>
                    <div class="text-end">
                        <small class="d-block text-muted">Win Rate</small>
                        <span
                            class="badge {{ 'bg-success' if report.web_data.kpis.bad_chart_trading_win_rate|default(0)|float > 50 else 'bg-danger' }}">
                            {{ report.web_data.kpis.bad_chart_trading_win_rate|default(0)|float|round(1) }}%
                        </span>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-top">
                    <small class="text-muted">Net P&L</small>
                    <div
                        class="fw-bold {{ 'text-success' if report.web_data.kpis.bad_chart_trading_pnl|default(0)|float > 0 else 'text-danger' }}">
                        ‚Çπ{{ report.web_data.kpis.bad_chart_trading_pnl|default(0)|float|round(0) }}
                    </div>
                </div>

                <!-- AI INSIGHT -->
                <div class="mt-3 p-2 bg-light rounded text-start border-start border-4 border-danger">
                    <div class="d-flex align-items-center mb-1">
                        <i class="bi bi-robot text-danger me-2"></i>
                        <span class="fw-bold small text-dark">{{
                            report.analysis_text.context_performance.chart_quality.verdict | default("") }}</span>
                    </div>
                    <p class="small text-muted mb-0 lh-sm">{{
                        report.analysis_text.context_performance.chart_quality.reasoning | default("") }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 7. ATH Trading -->
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm metric-card">
            <div class="card-body text-center">
                <div class="metric-icon bg-primary-subtle text-primary mb-2">üöÄ</div>
                <h6 class="text-uppercase text-muted small fw-bold">ATH Trading</h6>
                <div class="d-flex justify-content-between px-3 mt-3">
                    <div class="text-start">
                        <small class="d-block text-muted">Count</small>
                        <span class="h5 mb-0">{{ report.web_data.kpis.ath_trading_count|default(0) }}</span>
                    </div>
                    <div class="text-end">
                        <small class="d-block text-muted">Win Rate</small>
                        <span
                            class="badge {{ 'bg-success' if report.web_data.kpis.ath_trading_win_rate|default(0)|float > 50 else 'bg-danger' }}">
                            {{ report.web_data.kpis.ath_trading_win_rate|default(0)|float|round(1) }}%
                        </span>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-top">
                    <small class="text-muted">Net P&L</small>
                    <div
                        class="fw-bold {{ 'text-success' if report.web_data.kpis.ath_trading_pnl|default(0)|float > 0 else 'text-danger' }}">
                        ‚Çπ{{ report.web_data.kpis.ath_trading_pnl|default(0)|float|round(0) }}
                    </div>
                </div>

                <!-- AI INSIGHT -->
                <div class="mt-3 p-2 bg-light rounded text-start border-start border-4 border-primary">
                    <div class="d-flex align-items-center mb-1">
                        <i class="bi bi-robot text-primary me-2"></i>
                        <span class="fw-bold small text-dark">{{ report.analysis_text.context_performance.ath.verdict |
                            default("") }}</span>
                    </div>
                    <p class="small text-muted mb-0 lh-sm">{{ report.analysis_text.context_performance.ath.reasoning |
                        default("") }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 8. ATL Trading -->
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm metric-card">
            <div class="card-body text-center">
                <div class="metric-icon bg-secondary-subtle text-secondary mb-2">‚öì</div>
                <h6 class="text-uppercase text-muted small fw-bold">ATL Trading</h6>
                <div class="d-flex justify-content-between px-3 mt-3">
                    <div class="text-start">
                        <small class="d-block text-muted">Count</small>
                        <span class="h5 mb-0">{{ report.web_data.kpis.atl_trading_count|default(0) }}</span>
                    </div>
                    <div class="text-end">
                        <small class="d-block text-muted">Win Rate</small>
                        <span
                            class="badge {{ 'bg-success' if report.web_data.kpis.atl_trading_win_rate|default(0)|float > 50 else 'bg-danger' }}">
                            {{ report.web_data.kpis.atl_trading_win_rate|default(0)|float|round(1) }}%
                        </span>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-top">
                    <small class="text-muted">Net P&L</small>
                    <div
                        class="fw-bold {{ 'text-success' if report.web_data.kpis.atl_trading_pnl|default(0)|float > 0 else 'text-danger' }}">
                        ‚Çπ{{ report.web_data.kpis.atl_trading_pnl|default(0)|float|round(0) }}
                    </div>
                </div>

                <!-- AI INSIGHT -->
                <div class="mt-3 p-2 bg-light rounded text-start border-start border-4 border-secondary">
                    <div class="d-flex align-items-center mb-1">
                        <i class="bi bi-robot text-secondary me-2"></i>
                        <span class="fw-bold small text-dark">{{ report.analysis_text.context_performance.atl.verdict |
                            default("") }}</span>
                    </div>
                    <p class="small text-muted mb-0 lh-sm">{{ report.analysis_text.context_performance.atl.reasoning |
                        default("") }}</p>
                </div>
            </div>
        </div>
    </div>
</div>